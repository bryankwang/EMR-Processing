<!DOCTYPE html>
<html>
{% load static %}
<head>
  <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'css/reset.css' %}" />
	<link rel="stylesheet" href="{% static 'css/global.css' %}" />
	<link rel="stylesheet" href="{% static 'css/patient-dashboard.css' %}" />
	<style>
		.admin-container {
			display: flex;
			gap: 20px;
			padding: 20px;
		}
		.card {
			backdrop-filter: blur(12.7px);
			background: linear-gradient(180deg, rgba(126, 246, 238, 0.527) 0%, rgba(255, 255, 255, 0) 100%), 
				radial-gradient(
				88% 88% at 50% 50%, 
				rgba(28, 42, 137, 0) 0%, #00083f58 100%
				);
			background-blend-mode: screen;
			border-radius: 15px;
			padding: 20px;
			border: 2px solid rgba(73, 187, 248, 0.41);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			margin-top: 60px;
			margin-bottom: 20px;
		}
		.form-group {
			margin-bottom: 15px;
		}
		.form-group label {
			display: block;
			margin-bottom: 5px;
			font-weight: 500;
		}
		.form-group input, .form-group select {
			box-shadow: inset 0px 3px 4.5px 0px rgba(0, 0, 0, 0.37);
			width: 100%;
			max-width: 500px;
			color: rgba(0, 0, 0, 0.34);
			font-size: 15px;
			font-style: italic;
			font-weight: 400;
			letter-spacing: 0px;
			text-align: left;
			padding: 12px 30px 10px 30px;
			box-sizing: border-box;
			border-radius: 25px;
			margin-bottom: 1em;
		}
		.btn-submit {
			box-shadow: inset 0px 4px 4px 0px rgba(255, 255, 255, 0.25);
			margin-top: 24px;
			min-height: 47px;
			flex-shrink: 0;
			color: #264586;
			font-size: 15px;
			font-family: 'Poppins', sans-serif;
			font-weight: 500;
			letter-spacing: 0px;
			text-align: center;
			align-self: flex-end;
			margin-left: auto;
			background: linear-gradient(180deg, #a0fbb6 0%, #4ad3b3 100%) top left / auto auto no-repeat;
			padding: 2px 18px 0 22px;
			border-radius: 25px;
		}
		.btn-submit:hover {
			filter: brightness(1.2);
			transition: filter 0.2s;
		}
		.relationships-list {
			margin-top: 20px;
		}
		.relationships-list li {
			padding: 10px;
			border-bottom: 1px solid #eee;
		}
		.section-title {
			text-shadow: 0px 4px 4px rgba(25, 40, 135, 0.27);
			color: #eee;
			margin-bottom: 15px;
			font-size: 1.5em;
			font-weight: 600;
		}
		.card-left {
			flex: 1;
			max-width: 400px;
		}
		.card-right {
			flex: 2;
		}
		.messages {
			margin-bottom: 20px;
		}
		.message {
			padding: 10px;
			margin-bottom: 10px;
			border-radius: 4px;
		}
		.message.success {
			background: #d4edda;
			color: #155724;
		}
		.message.error {
			background: #f8d7da;
			color: #721c24;
		}
	</style>
</head>

<body>
	<img src="{% static 'assets/NAVBAR.png' %}" class="nav-bar" />
	
	<div class="row1">
		<p class="text">Dashboard</p>
		<p class="text">Management</p>
		<a class="text" href="{% url 'process_emr' %}">EMR Upload</a>
		<p class="text">Profile</p>
	</div>

	<div class="admin-container">
		<div class="card">
			<h2 class="section-title">Create New User</h2>
			<form method="POST" action="{% url 'create_user' %}">
				{% csrf_token %}
				<div class="form-group">
					<label for="username">Username</label>
					<input type="text" id="username" name="username" required>
				</div>
				<div class="form-group">
					<label for="firstname">First Name</label>
					<input type="text" id="firstname" name="firstname" required>
				</div>
				<div class="form-group">
					<label for="lastname">Last Name</label>
					<input type="text" id="lastname" name="lastname" required>
				</div>
				<div class="form-group">
					<label for="email">Email</label>
					<input type="email" id="email" name="email" required>
				</div>
				<div class="form-group">
					<label for="password">Password</label>
					<input type="password" id="password" name="password" required>
				</div>
				<div class="form-group">
					<label for="role">Role</label>
					<select id="role" name="role" required>
						<option value="patient">Patient</option>
						<option value="HCP">Healthcare Professional</option>
					</select>
				</div>
				<button type="submit" class="btn-submit">Create User</button>
			</form>
		</div>

		<div class="card-right">
			<div class="card">
				<h2 class="section-title">Manage Patient-Provider Relationships</h2>
				<form method="POST" action="{% url 'manage_relationships' %}">
					{% csrf_token %}
					<div class="form-group">
						<label for="patient">Select Patient</label>
						<select id="patient" name="patient" required>
							{% for patient in patients %}
								<option value="{{ patient.id }}">{{ patient }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label for="provider">Select Provider</label>
						<select id="provider" name="provider" required>
							{% for provider in providers %}
								<option value="{{ provider.id }}">{{ provider }}</option>
							{% endfor %}
						</select>
					</div>
					<button type="submit" class="btn-submit">Assign Provider to Patient</button>
				</form>

				<div class="relationships-list">
					<h3 class="section-title">Current Relationships</h3>
					<ul>
						{% for relationship in relationships %}
							<li>{{ relationship.patient }} - {{ relationship.hcp }}</li>
						{% endfor %}
					</ul>
				</div>
			</div>

			{% if messages %}
			<div class="messages">
				{% for message in messages %}
					<div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
						{{ message }}
					</div>
				{% endfor %}
			</div>
			{% endif %}
		</div>
	</div>

	<!-- Modal skeleton for add/edit user (to be implemented) -->
	<div id="user-modal" class="modal" style="display:none;">
		<div class="row2 admin-management">
			<div class="card-left admin-left">
				<h2 class="admin-title">User Management</h2>
				<p class="admin-desc">Manage patients and healthcare professionals. Use the controls to search, add, edit, or remove users.</p>
				<div class="admin-controls">
					<input type="text" id="user-search" placeholder="Search users by name or email" />
					<button id="btn-add-user" class="btn-primary">Add User</button>
				</div>
			
				<div class="admin-tabs">
					<button class="tab active" data-filter="all">All</button>
					<button class="tab" data-filter="patients">Patients</button>
					<button class="tab" data-filter="professionals">Professionals</button>
				</div>
			</div>

			<div class="msgs-appts admin-right">
				<div class="msgs-appts-box">
					<table class="admin-table">
						<thead>
							<tr>
								<th>Name</th>
								<th>Email</th>
								<th>Role</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user in template_data.users %}
							<tr data-role="{{ user.role }}">
								<td>{{ user.first_name }} {{ user.last_name }}</td>
								<td>{{ user.email }}</td>
								<td>{{ user.role }}</td>
								<td>
									<a href="{% url 'admin_edit_user' user.id %}">Edit</a> |
									<a href="{% url 'admin_delete_user' user.id %}" class="danger">Delete</a>
								</td>
							</tr>
							{% empty %}
							<tr><td colspan="4">No users found.</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>